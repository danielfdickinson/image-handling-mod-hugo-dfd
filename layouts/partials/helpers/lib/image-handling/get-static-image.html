{{- $destination := .destination -}}
{{- $getRelative := .getRelative -}}
{{- $finalDestination := "" -}}
{{- if $destination -}}
    {{- if not (strings.HasPrefix $destination "data:image") -}}
        {{- if not $getRelative -}}
            {{- $finalDestination = $destination | absURL -}}
        {{- else -}}
            {{- $finalDestination = $destination | absURL | relURL -}}{{- /* Canonicalize the URL */ -}}
        {{- end -}}
    {{- else -}}
        {{- $finalDestination = $destination -}}
    {{- end -}}
{{- end -}}
{{- return $finalDestination -}}
{{- /* Remove trailing newlines */ -}}

