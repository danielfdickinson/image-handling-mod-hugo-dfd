{{- $curPage := .page -}}
{{- $relativeURL := .getRelative -}}
{{- $ignoreBundleAssets := .ignoreBundleAssets -}}
{{- $featured := false -}}
{{- $featuredLink := "" -}}

{{- /* Try page-level images first */ -}}
{{- $featuredParam := $curPage.Params.imageFeatured | default $curPage.Params.imageCover | default $curPage.Params.imageThumbnail -}}
{{- $featuredAlt := $curPage.Params.imageFeaturedAlt | default $curPage.Params.imageCoverAlt | default $curPage.Params.imageThumbnailAlt -}}
{{- $imageResources := $curPage.Resources.ByType "image" -}}
{{- if and $featuredParam $imageResources -}}
    {{- $featured = $imageResources.GetMatch (printf "*%s*" $featuredParam) -}}
{{- else if $imageResources -}}
    {{- $featured = $imageResources.GetMatch "*feature*" -}}
{{- end -}}
{{- if not $featured -}}
    {{- $featured = $imageResources.GetMatch "{*cover*,*thumbnail*}" -}}
{{- end -}}
{{- with $featured -}}
    {{- $featuredLink = partial "helpers/lib/image-handling/get-resource-link" (dict "imageResource" $featured "getRelative" $relativeURL) -}}
{{- end -}}
{{- return (dict "imageResource" $featured "link" $featuredLink "alt" $featuredAlt) -}}